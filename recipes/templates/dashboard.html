{% extends "base.html" %}
{% load static %}

{% block body_class %}dashboard-body{% endblock %}

{% block body %}
{% include "partials/navbar_app.html" %}

<main class="cosmos-home">
  <div class="container-fluid px-4 px-xl-5 py-4">

    <form method="get" class="mb-4 d-flex align-items-center justify-content-center dashboard-filters">

      <!-- Category -->
      <select
        name="category"
        class="form-select dashboard-filter-select"
        onchange="this.form.submit()"
      >
        <option value="all"{% if not category or category == "all" %} selected{% endif %}>
          All categories
        </option>
        <option value="breakfast"{% if category == "breakfast" %} selected{% endif %}>Breakfast</option>
        <option value="lunch"{% if category == "lunch" %} selected{% endif %}>Lunch</option>
        <option value="dinner"{% if category == "dinner" %} selected{% endif %}>Dinner</option>
        <option value="dessert"{% if category == "dessert" %} selected{% endif %}>Dessert</option>
        <option value="vegan"{% if category == "vegan" %} selected{% endif %}>Vegan</option>
      </select>

      <!-- Ingredient text filter -->
      <input
        type="text"
        name="ingredient"
        class="form-control dashboard-filter-input"
        placeholder="Filter by ingredient (e.g. chicken)"
        value="{{ ingredient|default:'' }}"
      >

      <!-- Sorting -->
      <select
        name="sort"
        class="form-select dashboard-filter-select"
        onchange="this.form.submit()"
      >
        <option value="newest"{% if not sort or sort == "newest" %} selected{% endif %}>
          Newest
        </option>
        <option value="popular"{% if sort == "popular" %} selected{% endif %}>
          Most popular
        </option>
        <option value="oldest"{% if sort == "oldest" %} selected{% endif %}>
          Oldest
        </option>
      </select>

    </form>

    {% if popular_recipes %}
      <h4 class="mb-3">Most Popular</h4>
      {% include "partials/recipe_grid.html" with posts=popular_recipes %}
    {% endif %}

    <div class="row justify-content-center mb-4">
      <div class="col-auto">
        <ul class="nav nav-pills cosmos-toggle" id="cosmosFeedTabs" role="tablist">

          <li class="nav-item" role="presentation">
            <button
              class="nav-link active"
              id="forYou-tab"
              data-bs-toggle="pill"
              data-bs-target="#forYou"
              type="button"
              role="tab"
              aria-selected="true"
            >
              For you
            </button>
          </li>

          <li class="nav-item" role="presentation">
            <button
              class="nav-link"
              id="following-tab"
              data-bs-toggle="pill"
              data-bs-target="#following"
              type="button"
              role="tab"
              aria-selected="false"
            >
              Following
            </button>
          </li>

        </ul>
      </div>
    </div>

    <div class="tab-content">

      <div class="tab-pane fade show active" id="forYou" role="tabpanel" aria-labelledby="forYou-tab">
        {% if for_you_posts %}
          {% include "partials/recipe_grid.html" with posts=for_you_posts %}
        {% else %}
          <div class="text-center py-5" style="color: #8b8c9a;">
            Nothing here yet â€” your personalised feed will appear here soon.
          </div>
        {% endif %}
      </div>

      <div class="tab-pane fade" id="following" role="tabpanel" aria-labelledby="following-tab">
        {% if following_posts %}
          {% include "partials/recipe_grid.html" with posts=following_posts %}
        {% else %}
          <div class="text-center py-5" style="color: #8b8c9a;">
            Follow some cullinarians to get started!
          </div>
        {% endif %}
      </div>

    </div>

  </div>
</main>
{% endblock %}
