{% extends "base.html" %}

{% block body_class %}dashboard-body profile-body{% endblock %}

{% block body %}
{% include "partials/navbar_app.html" %}

<main class="collection-shell container-fluid px-4 px-xl-5 pb-5">
  <header class="collection-header text-center">
    <p class="collection-owner text-muted small mb-1">
      {{ collection.followers|default:0 }} Follower{% if collection.followers|default:0 != 1 %}s{% endif %} Â· {{ profile.handle }}
    </p>
    <h1 class="collection-title mb-1">{{ collection.title }}</h1>
    {% if collection.description %}
      <p class="collection-description mb-1">{{ collection.description }}</p>
    {% endif %}
    <div class="collection-menu-wrapper d-inline-block position-relative">
      <button
        type="button"
        class="btn p-0 border-0 bg-transparent collection-menu-trigger"
        aria-label="Collection options"
        data-collection-menu-toggle
      >
        <i class="bi bi-three-dots"></i>
      </button>
      <div class="collection-menu shadow-lg" data-collection-menu>
        <button type="button" class="collection-menu-item">Edit details</button>
        <button type="button" class="collection-menu-item collection-menu-item-danger">Delete</button>
      </div>
    </div>
  </header>

  <section class="collection-grid">
    {% for item in collection.items %}
      <article class="collection-item">
        <div class="collection-item-thumb" style="background-image: url('{{ item }}');"></div>
        {% if forloop.first %}
          <div class="collection-check">
            <span>Traverse</span>
            <i class="bi bi-check2"></i>
          </div>
        {% endif %}
      </article>
    {% endfor %}
  </section>
</main>
<script>
  document.addEventListener('DOMContentLoaded', function () {
    const trigger = document.querySelector('[data-collection-menu-toggle]');
    const menu = document.querySelector('[data-collection-menu]');
    if (!trigger || !menu) return;

    const openClass = 'collection-menu-open';

    const closeMenu = () => {
      menu.classList.remove(openClass);
      document.removeEventListener('click', outsideHandler, true);
      document.removeEventListener('keydown', escHandler, true);
    };

    const outsideHandler = (event) => {
      if (menu.contains(event.target) || trigger.contains(event.target)) return;
      closeMenu();
    };

    const escHandler = (event) => {
      if (event.key === 'Escape') {
        closeMenu();
      }
    };

    trigger.addEventListener('click', function (event) {
      event.preventDefault();
      const isOpen = menu.classList.contains(openClass);
      if (isOpen) {
        closeMenu();
      } else {
        menu.classList.add(openClass);
        document.addEventListener('click', outsideHandler, true);
        document.addEventListener('keydown', escHandler, true);
      }
    });

    const editBtn = menu.querySelector('.collection-menu-item:not(.collection-menu-item-danger)');
    const deleteBtn = menu.querySelector('.collection-menu-item-danger');

    if (editBtn) {
      editBtn.addEventListener('click', function (event) {
        event.preventDefault();
        // Placeholder hook for future edit behaviour
        closeMenu();
      });
    }

    if (deleteBtn) {
      deleteBtn.addEventListener('click', function (event) {
        event.preventDefault();
        // Placeholder hook for future delete behaviour
        closeMenu();
      });
    }
  });
</script>
{% endblock %}
