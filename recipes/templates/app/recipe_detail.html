{% extends "base/base_app.html" %}
{% load static %}

{% block content %}
  <main class="recipe-detail-page">
    <div class="recipe-detail-layout">
      <section>
        <h1 class="recipe-detail-title">{{ post.title }}</h1>

        <p class="recipe-detail-author">
          By <span class="recipe-detail-author-link">@{{ post.author.username }}</span>
          {% if request.user.is_authenticated and request.user != post.author %}
            <form
              method="post"
              action="{% url 'toggle_follow' post.author.username %}"
              class="d-inline"
            >
              {% csrf_token %}
              <button type="submit" class="btn btn-sm btn-outline-light ms-2">
                {% if is_following_author %}Following{% else %}Follow{% endif %}
              </button>
            </form>
          {% endif %}
        </p>

        {% if post.description %}
          <p class="recipe-detail-description">{{ post.description }}</p>
        {% endif %}

        <p class="recipe-detail-meta">
          {% if post.prep_time_min %}Prep: {{ post.prep_time_min }} min{% endif %}
          {% if post.cook_time_min %}
            {% if post.prep_time_min %} · {% endif %}
            Cook: {{ post.cook_time_min }} min
          {% endif %}
          {% if post.nutrition %}
            · {{ post.nutrition }}
          {% endif %}
        </p>

        {% if ingredients %}
          <h2 class="recipe-detail-heading">Ingredients</h2>
          <ul class="recipe-detail-list">
            {% for ingredient in ingredients %}
              <li>{{ ingredient }}</li>
            {% endfor %}
          </ul>
        {% endif %}

        {% if steps %}
          <h2 class="recipe-detail-heading">Steps</h2>
          <ol class="recipe-detail-steps">
            {% for step in steps %}
              <li>
                <span class="recipe-step-index">{{ forloop.counter }}.</span>
                <span>{{ step }}</span>
              </li>
            {% endfor %}
          </ol>
        {% endif %}
      </section>

      <aside class="recipe-detail-sidebar">
        <div class="recipe-meta-card mb-3">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <span class="recipe-meta-label">Actions</span>
          </div>
          <div>
            <form method="post" action="{% url 'toggle_favourite' post.id %}" class="d-inline">
              {% csrf_token %}
              <button type="submit"
                      class="btn btn-sm btn-outline-light rounded-pill me-2">
                {% if user_saved %}Saved{% else %}Save{% endif %}
              </button>
            </form>

            <form method="post" action="{% url 'toggle_like' post.id %}" class="d-inline">
              {% csrf_token %}
              <button type="submit"
                      class="btn btn-sm btn-outline-light rounded-pill">
                {% if user_liked %}Liked{% else %}Like{% endif %}
              </button>
            </form>
          </div>
        </div>

        <div class="recipe-meta-card">
          <div class="recipe-meta-label mb-1">About the author</div>
          <div class="recipe-author-name">{{ post.author.username }}</div>

          <a href="{% url 'profile' %}?user={{ post.author.username }}"
             class="btn btn-sm btn-outline-light rounded-pill mt-2">
            View profile
          </a>
        </div>
      </aside>
    </div>
	  </main>
{% endblock %}
