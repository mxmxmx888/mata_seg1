{% extends "base.html" %}
{% load static %}

{% block body_class %}dashboard-body profile-body{% endblock %}

{% block body %}
{% include "partials/navbar_app.html" %}
{% include "partials/messages.html" %}

<main class="profile-shell container-fluid px-4 px-xl-5 pb-5">
  <section class="profile-hero text-center">
    <div class="profile-avatar">
      <img src="{{ profile.avatar_url }}" alt="{{ profile.display_name }} avatar">
    </div>
    <h1 class="profile-name mb-1">{{ profile.display_name }}</h1>
    <p class="profile-handle small mb-1">{{ profile.handle }} · {{ profile.following }} Following</p>
    <p class="profile-tagline mb-3">{{ profile.tagline }}</p>
    <div class="profile-actions d-flex justify-content-center gap-2 flex-wrap">
      {% if is_own_profile %}
      <button type="button" class="profile-pill" data-bs-toggle="modal" data-bs-target="#editProfileModal">
        Edit Profile
      </button>
      {% endif %}
    </div>
  </section>

  <section class="profile-collections-grid">
    <div class="profile-collections">
      {% for collection in collections %}
      <a class="collection-card" href="{% url 'collection_detail' collection.slug %}">
        <div class="collection-thumb" style="background-image: url('{{ collection.cover }}');"></div>
        <div class="collection-overlay"></div>
        <div class="collection-meta">
          <p class="collection-title mb-0">{{ collection.title }}</p>
          <p class="collection-sub mb-0">
            {{ collection.count }} recipes{% if collection.privacy %} · {{ collection.privacy }}{% endif %}
          </p>
        </div>
      </a>
      {% endfor %}
    </div>
  </section>

  {% if posts %}
  <section class="mt-4">
    <h2 class="h5 mb-3">Recipes</h2>
    <div class="cosmos-grid">
      {% include "partials/recipe_grid.html" with posts=posts %}
    </div>
  </section>
  {% endif %}
</main>

{% if is_own_profile %}
<div class="modal fade edit-profile-modal" id="editProfileModal" tabindex="-1" aria-labelledby="editProfileModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header border-0">
        <div>
          <p class="text-muted small mb-1 text-uppercase">Profile</p>
          <h5 class="modal-title mb-0" id="editProfileModalLabel">Edit details</h5>
        </div>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <form method="post">
        {% csrf_token %}
        <div class="modal-body">
          {% include 'partials/bootstrap_form.html' with form=form %}
        </div>
        <div class="modal-footer border-0">
          <button type="button" class="btn btn-outline-light rounded-pill px-3" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-light rounded-pill px-3">Save</button>
        </div>
      </form>
    </div>
  </div>
</div>
{% endif %}
{% endblock %}

