<div class="col-xxl-4 col-xl-4 col-lg-4">
  <header class="mb-4">
    {% with recipe.author.username|default:author_handle as author_username %}
    <p class="post-author text-muted mb-1">
      by <a class="post-author-link" href="{% url 'profile' %}?user={{ author_username }}">{{ author_username }}</a>
    </p>
    {% endwith %}
    <h1 class="post-title">{{ title }}</h1>
    <div class="d-flex flex-wrap gap-3 post-meta">
      <span><i class="bi bi-clock-history me-1"></i>{{ cook_time }}</span>
      {% if serves %}
      <span><i class="bi bi-people-fill me-1"></i>Serves {{ serves }}</span>
      {% endif %}
      <span><i class="bi bi-list-ul me-1"></i>{{ ingredients|length }} ingredients</span>
      <span class="badge bg-secondary text-uppercase">
        {% if recipe.visibility == 'public' %}Public{% elif recipe.visibility == 'followers' %}Followers only{% else %}Close friends only{% endif %}
      </span>
    </div>
    <p class="text-muted small mb-0">
      Published {% if recipe.published_at %}{{ recipe.published_at|timesince }}{% else %}{{ recipe.created_at|timesince }}{% endif %} ago
    </p>
  </header>

  <p class="post-summary text-muted mb-4">{{ summary }}</p>

  {% if shop_ingredients %}
  <section class="mb-4">
    <div class="post-shop-links d-flex flex-wrap">
      {% for ing in shop_ingredients %}
      <a href="{{ ing.shop_url }}" target="_blank" class="post-shop-link btn rounded-pill d-inline-flex align-items-center gap-2 py-2 px-3">
        {% if ing.shop_image_upload %}
        <span class="post-shop-link-thumb" aria-hidden="true">
          <img
            src="{{ ing.shop_image_upload.url }}"
            alt=""
            loading="lazy"
            class="js-gallery-image"
            data-fullsrc="{{ ing.shop_image_upload.url }}"
          >
        </span>
        {% endif %}
        <span>{{ ing.name|title }}</span>
        <i class="bi bi-arrow-up-right small"></i>
      </a>
      {% endfor %}
    </div>
  </section>
  {% endif %}

  {% if ingredients %}
  <section class="mb-4">
    <h2 class="h4 fw-semibold mb-2">Ingredients</h2>
    <ul class="post-ingredients mt-1">
      {% for ingredient in ingredients %}
      <li class="d-flex align-items-center justify-content-between">
        <span>{{ ingredient.name|title }}</span>
      </li>
      {% endfor %}
    </ul>
  </section>
  {% endif %}

  {% if steps %}
  <section class="mb-4">
    <h2 class="h4 fw-semibold mb-2">Steps</h2>
    <ol class="post-steps mt-1">
      {% for step in steps %}
      <li>{{ step }}</li>
      {% endfor %}
    </ol>
  </section>
  {% endif %}

  {% if recipe.nutrition %}
  <section class="mb-4">
    <h2 class="h4 fw-semibold mb-2">Nutrition</h2>
    <p class="mb-0">{{ recipe.nutrition|linebreaksbr }}</p>
  </section>
  {% endif %}

  {% if tags %}
  <section class="post-tags mb-4">
    <button class="post-tags-toggle d-flex align-items-center gap-2" type="button" data-bs-toggle="collapse" data-bs-target="#post-tags-collapse" aria-expanded="false">
      <span class="fw-semibold small text-muted text-uppercase tracking-wide">Tags</span>
      <span class="post-tags-chevron">âŒƒ</span>
    </button>
    <div class="collapse mt-2" id="post-tags-collapse">
      <div class="d-flex flex-wrap gap-2">
        {% for tag in tags %}
        <span class="post-tag-pill">#{{ tag }}</span>
        {% endfor %}
      </div>
    </div>
  </section>
  {% endif %}
</div>
